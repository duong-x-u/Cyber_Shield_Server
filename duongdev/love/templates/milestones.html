{% extends 'base.html' %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-heart"></i> C·ªôt m·ªëc & K·ª∑ ni·ªám</h1>
    <p>Nh·ªØng ng√†y ƒë·∫∑c bi·ªát c·ªßa ch√∫ng m√¨nh</p>
</div>

<!-- Upcoming milestones highlight -->
<div class="upcoming-highlight">
    <h2><i class="fas fa-clock"></i> S·∫Øp ƒë·∫øn</h2>
    <div class="upcoming-cards">
        {% if upcoming %}
            {% for item in upcoming[:3] %}
            <div class="countdown-card">
                <div class="countdown-number">{{ item.days_left }}</div>
                <div class="countdown-label">ng√†y n·ªØa</div>
                <div class="countdown-title">{{ item.title }}</div>
                <div class="countdown-date">{{ item.date.strftime('%d/%m/%Y') }}</div>
            </div>
            {% endfor %}
        {% endif %}
    </div>
</div>

<!-- Add milestone -->
<div class="add-section">
    <button class="btn-add" id="toggleMilestoneForm">
        <i class="fas fa-plus"></i> Th√™m k·ª∑ ni·ªám m·ªõi
    </button>
    
    <form class="add-form" id="milestoneForm" action="{{ url_for('add_milestone') }}" method="POST" style="display: none;">
        <div class="form-group">
            <label for="title">T√™n k·ª∑ ni·ªám</label>
            <input type="text" id="title" name="title" required placeholder="VD: Ng√†y h·∫πn h√≤ ƒë·∫ßu ti√™n">
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="date">Ng√†y</label>
                <input type="date" id="date" name="date" required>
            </div>
            <div class="form-group">
                <label for="icon">Bi·ªÉu t∆∞·ª£ng</label>
                <select id="icon" name="icon">
                    <option value="heart">‚ù§Ô∏è Tim</option>
                    <option value="ring">üíç Nh·∫´n</option>
                    <option value="gift">üéÅ Qu√†</option>
                    <option value="cake">üéÇ B√°nh</option>
                    <option value="travel">‚úàÔ∏è Du l·ªãch</option>
                    <option value="home">üè† Nh√†</option>
                    <option value="star">‚≠ê Sao</option>
                    <option value="flower">üå∏ Hoa</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label for="description">M√¥ t·∫£</label>
            <textarea id="description" name="description" rows="3" placeholder="Ghi ch√∫ th√™m v·ªÅ ng√†y n√†y..."></textarea>
        </div>
        
        <div class="form-group checkbox-group">
            <input type="checkbox" id="is_recurring" name="is_recurring">
            <label for="is_recurring">L·∫∑p l·∫°i h√†ng nƒÉm</label>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-primary">
                <i class="fas fa-save"></i> L∆∞u k·ª∑ ni·ªám
            </button>
            <button type="button" class="btn-secondary" id="cancelMilestone">H·ªßy</button>
        </div>
    </form>
</div>

<!-- Timeline -->
<div class="timeline">
    <div class="timeline-item special">
        <div class="timeline-marker">üíï</div>
        <div class="timeline-content">
            <h3>Ng√†y b·∫Øt ƒë·∫ßu y√™u</h3>
            <p class="timeline-date">28/11/2025 - 15:51</p>
            <p>Ng√†y m√† t·∫•t c·∫£ b·∫Øt ƒë·∫ßu...</p>
        </div>
    </div>
    
    {% if milestones %}
        {% for milestone in milestones %}
        <div class="timeline-item">
            <div class="timeline-marker">
                {% if milestone.icon == 'heart' %}‚ù§Ô∏è
                {% elif milestone.icon == 'ring' %}üíç
                {% elif milestone.icon == 'gift' %}üéÅ
                {% elif milestone.icon == 'cake' %}üéÇ
                {% elif milestone.icon == 'travel' %}‚úàÔ∏è
                {% elif milestone.icon == 'home' %}üè†
                {% elif milestone.icon == 'star' %}‚≠ê
                {% elif milestone.icon == 'flower' %}üå∏
                {% else %}üíñ{% endif %}
            </div>
            <div class="timeline-content">
                <h3>{{ milestone.title }}</h3>
                <p class="timeline-date">{{ milestone.date.strftime('%d/%m/%Y') }}</p>
                {% if milestone.description %}
                <p>{{ milestone.description }}</p>
                {% endif %}
                {% if milestone.is_recurring %}
                <span class="badge">üîÑ H√†ng nƒÉm</span>
                {% endif %}
            </div>
            <button class="btn-delete-timeline" data-delete-url="{{ url_for('delete_milestone', id=milestone.id) }}">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        {% endfor %}
    {% endif %}
</div>

<!-- Delete modal -->
<div class="modal" id="deleteModal">
    <div class="modal-content">
        <h3>X√°c nh·∫≠n x√≥a</h3>
        <p>B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a k·ª∑ ni·ªám n√†y kh√¥ng?</p>
        <div class="modal-actions">
            <a href="#" id="confirmDeleteBtn" class="btn-danger">X√≥a</a>
            <button type="button" class="btn-secondary" id="cancelDeleteBtn">H·ªßy</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Toggle form
    document.getElementById('toggleMilestoneForm').addEventListener('click', function() {
        var form = document.getElementById('milestoneForm');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
        this.style.display = 'none';
    });
    
    document.getElementById('cancelMilestone').addEventListener('click', function() {
        document.getElementById('milestoneForm').style.display = 'none';
        document.getElementById('toggleMilestoneForm').style.display = 'block';
    });
    
    // Delete milestone
    document.querySelectorAll('.btn-delete-timeline').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var url = this.getAttribute('data-delete-url');
            document.getElementById('confirmDeleteBtn').href = url;
            document.getElementById('deleteModal').classList.add('active');
        });
    });
    
    document.getElementById('cancelDeleteBtn').addEventListener('click', function() {
        document.getElementById('deleteModal').classList.remove('active');
    });
    
    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) {
            this.classList.remove('active');
        }
    });
</script>
{% endblock %}