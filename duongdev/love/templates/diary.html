{% extends 'base.html' %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-book-heart"></i> Nh·∫≠t k√Ω t√¨nh y√™u</h1>
    <p>Ghi l·∫°i nh·ªØng kho·∫£nh kh·∫Øc ƒë√°ng nh·ªõ c·ªßa ch√∫ng m√¨nh</p>
</div>

<!-- Add new entry -->
<div class="add-section">
    <button class="btn-add" id="toggleDiaryForm">
        <i class="fas fa-plus"></i> Vi·∫øt nh·∫≠t k√Ω m·ªõi
    </button>
    
    <form class="add-form" id="diaryForm" action="{{ url_for('add_diary') }}" method="POST" style="display: none;">
        <div class="form-group">
            <label for="title">Ti√™u ƒë·ªÅ</label>
            <input type="text" id="title" name="title" required placeholder="H√¥m nay c√≥ g√¨ vui?">
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="date">Ng√†y</label>
                <input type="date" id="date" name="date">
            </div>
            <div class="form-group">
                <label for="mood">T√¢m tr·∫°ng</label>
                <select id="mood" name="mood">
                    <option value="love">üòç Y√™u</option>
                    <option value="happy">üòä Vui</option>
                    <option value="excited">ü•∞ H·∫°nh ph√∫c</option>
                    <option value="grateful">üôè Bi·∫øt ∆°n</option>
                    <option value="romantic">üíï L√£ng m·∫°n</option>
                    <option value="miss">üí≠ Nh·ªõ</option>
                    <option value="sad">üò¢ Bu·ªìn</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label for="content">N·ªôi dung</label>
            <textarea id="content" name="content" rows="6" required placeholder="Vi·∫øt nh·ªØng g√¨ b·∫°n mu·ªën l∆∞u gi·ªØ..."></textarea>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-primary">
                <i class="fas fa-save"></i> L∆∞u nh·∫≠t k√Ω
            </button>
            <button type="button" class="btn-secondary" id="cancelDiary">H·ªßy</button>
        </div>
    </form>
</div>

<!-- Diary entries -->
<div class="diary-list">
    {% if entries %}
        {% for entry in entries %}
        <div class="diary-entry">
            <div class="entry-header">
                <div class="entry-mood">
                    {% if entry.mood == 'happy' %}üòä
                    {% elif entry.mood == 'love' %}üòç
                    {% elif entry.mood == 'excited' %}ü•∞
                    {% elif entry.mood == 'grateful' %}üôè
                    {% elif entry.mood == 'romantic' %}üíï
                    {% elif entry.mood == 'miss' %}üí≠
                    {% elif entry.mood == 'sad' %}üò¢
                    {% else %}üíñ{% endif %}
                </div>
                <div class="entry-meta">
                    <h3 class="entry-title">{{ entry.title }}</h3>
                    <span class="entry-date">
                        <i class="fas fa-calendar"></i> 
                        {{ entry.date.strftime('%d/%m/%Y') }}
                    </span>
                </div>
                <div class="entry-actions">
                    <a href="{{ url_for('edit_diary', id=entry.id) }}" class="btn-edit" title="Ch·ªânh s·ª≠a">
                        <i class="fas fa-pen"></i>
                    </a>
                    <button class="btn-delete-trigger" data-delete-url="{{ url_for('delete_diary', id=entry.id) }}" title="X√≥a (Good luck üòà)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="entry-content">
                {{ entry.content | safe }}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <i class="fas fa-book-open"></i>
            <h3>Ch∆∞a c√≥ nh·∫≠t k√Ω n√†o</h3>
            <p>H√£y b·∫Øt ƒë·∫ßu ghi l·∫°i c√¢u chuy·ªán t√¨nh y√™u c·ªßa b·∫°n!</p>
        </div>
    {% endif %}
</div>

<!-- ================================================== -->
<!-- N√öT X√ìA BAY KH·∫ÆP M√ÄN H√åNH üòà -->
<!-- ================================================== -->
<button class="flying-delete-btn" id="flyingDeleteBtn" style="display: none;">
    <span id="flyingBtnText">X√≥a (100)</span>
</button>

<!-- ================================================== -->
<!-- DELETE MODAL - CHIA TAY KH√ì L·∫ÆM EDITION üòàüî• -->
<!-- ================================================== -->
<div class="modal" id="deleteModal">
    <div class="modal-content delete-modal-content" id="modalContent">
        <div class="delete-header">
            <span class="delete-emoji" id="deleteEmoji">ü§î</span>
            <h3 id="deleteTitle">B·∫°n mu·ªën x√≥a k·ª∑ ni·ªám?</h3>
            <p class="delete-tagline">POV: Chia tay tui kh√≥ l·∫Øm üòà</p>
        </div>
        
        <p id="deleteMessage">ƒê∆∞·ª£c th√¥i... nh∆∞ng ph·∫£i v∆∞·ª£t qua ƒë·ªãa ng·ª•c ƒë√£!</p>
        
        <!-- Progress bar -->
        <div class="delete-progress-container">
            <div class="delete-progress-bar" id="deleteProgressBar"></div>
            <span class="delete-progress-text" id="deleteProgressText">0 / 100</span>
        </div>
        
        <!-- Challenge queue display -->
        <div class="challenge-queue" id="challengeQueue">
            <div class="queue-title">üìã H√†ng ƒë·ª£i th·ª≠ th√°ch:</div>
            <div class="queue-items" id="queueItems"></div>
        </div>
        
        <!-- CAPTCHA Challenge -->
        <div class="challenge-box" id="captchaChallenge" style="display: none;">
            <div class="challenge-header captcha-header">
                <span>üîê CAPTCHA</span>
            </div>
            <p>Nh·∫≠p m√£ b√™n d∆∞·ªõi:</p>
            <div class="captcha-display" id="captchaDisplay">ABC123</div>
            <input type="text" id="captchaInput" placeholder="Nh·∫≠p m√£...">
            <button type="button" class="btn-challenge" id="captchaSubmit">X√°c nh·∫≠n</button>
            <p class="challenge-error" id="captchaError" style="display: none;">‚ùå Sai r·ªìi!</p>
        </div>
        
        <!-- Math Challenge -->
        <div class="challenge-box" id="mathChallenge" style="display: none;">
            <div class="challenge-header math-header">
                <span>üìê TO√ÅN T√åNH Y√äU</span>
            </div>
            <div class="math-problem" id="mathProblem"></div>
            <input type="text" id="mathInput" placeholder="Nh·∫≠p ƒë√°p √°n...">
            <button type="button" class="btn-challenge" id="mathSubmit">Ki·ªÉm tra</button>
            <p class="challenge-error" id="mathError" style="display: none;">‚ùå Sai! T√≠nh l·∫°i ƒëi üò§</p>
            <button type="button" class="btn-hint" id="mathHintBtn">üí° Xem g·ª£i √Ω</button>
            <p class="math-hint" id="mathHint" style="display: none;"></p>
        </div>
        
        <!-- Type Challenge -->
        <div class="challenge-box" id="typeChallenge" style="display: none;">
            <div class="challenge-header type-header">
                <span>‚å®Ô∏è G√ï CH·ªÆ</span>
            </div>
            <p>G√µ ch√≠nh x√°c c√¢u sau:</p>
            <div class="type-sentence">"T√¥i kh√¥ng mu·ªën x√≥a k·ª∑ ni·ªám ƒë·∫πp n√†y"</div>
            <input type="text" id="typeInput" placeholder="G√µ c√¢u tr√™n...">
            <button type="button" class="btn-challenge" id="typeSubmit">Ki·ªÉm tra</button>
            <p class="type-progress" id="typeProgress">‚úÖ 0 / 10 l·∫ßn</p>
            <p class="challenge-error" id="typeError" style="display: none;">‚ùå Sai! G√µ l·∫°i ƒëi!</p>
        </div>
        
        <!-- Cooldown display -->
        <div class="cooldown-display" id="cooldownDisplay" style="display: none;">
            <p>‚è±Ô∏è Ch·ªù <span id="cooldownTime">5</span>s ƒë·ªÉ ti·∫øp t·ª•c...</p>
            <div class="cooldown-bar">
                <div class="cooldown-progress" id="cooldownProgress"></div>
            </div>
        </div>
        
        <!-- Return countdown for flying button -->
        <div class="return-countdown" id="returnCountdown" style="display: none;">
            <p>üéØ N√∫t s·∫Ω quay l·∫°i sau: <span id="returnTime">10</span>s</p>
            <p class="return-hint">Ho·∫∑c ƒëu·ªïi theo n√≥ ƒëi! üòà</p>
        </div>
        
        <!-- Hint messages -->
        <p class="delete-hint" id="deleteHint">B·∫•m n√∫t ƒë·ªÉ b·∫Øt ƒë·∫ßu h√†nh tr√¨nh ƒë·ªãa ng·ª•c üíÄ</p>
        
        <div class="modal-actions">
            <button type="button" class="btn-keep" id="cancelDeleteBtn">
                <i class="fas fa-heart"></i> Th√¥i, gi·ªØ l·∫°i üíï
            </button>
            <div class="delete-btn-container" id="deleteBtnContainer">
                <button type="button" class="btn-delete-confirm" id="confirmDeleteBtn">
                    <span id="deleteBtnText">B·∫Øt ƒë·∫ßu (100)</span>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // ==========================================
    // FORM TOGGLE
    // ==========================================
    document.getElementById('toggleDiaryForm').addEventListener('click', function() {
        var form = document.getElementById('diaryForm');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
        this.style.display = 'none';
    });
    
    document.getElementById('cancelDiary').addEventListener('click', function() {
        document.getElementById('diaryForm').style.display = 'none';
        document.getElementById('toggleDiaryForm').style.display = 'block';
    });
    
    // ==========================================
    // C·∫§U H√åNH ƒê·ªäA NG·ª§C üòà
    // ==========================================
    var CONFIG = {
        CLICKS_REQUIRED: 100,
        COOLDOWN_SECONDS: 5,
        CAPTCHA_INTERVAL: 10,
        MATH_START_AT: 50,
        TYPE_TRIGGER: 50,
        TYPE_REQUIRED: 10,
        BUTTON_RETURN_SECONDS: 10
    };
    
    // ==========================================
    // STATE
    // ==========================================
    var state = {
        deleteUrl: '',
        clickCount: 0,
        typeCount: 0,
        typeDone: false,
        isOnCooldown: false,
        cooldownTimer: null,
        returnTimer: null,
        returnCountdown: null,
        currentCaptcha: '',
        currentMath: null,
        pendingChallenges: [],
        buttonIsFlying: false
    };
    
    // ==========================================
    // TO√ÅN TH·ª∞C T·∫æ - Phi√™n b·∫£n T√åNH Y√äU üíï
    // ==========================================
    var mathProblems = [
        // TO√ÅN T√çNH TI·ªÄN DATE üí∏
        {
            q: "Hai ƒë·ª©a ƒëi ƒÉn h·∫øt 185k, chia ƒë√¥i m·ªói ng∆∞·ªùi bao nhi√™u?",
            hint: "185.000 √∑ 2 = ?",
            a: ["92500", "92.500", "92500ƒë", "92.5k"]
        },
        {
            q: "Tr√† s·ªØa 45k, gi·∫£m 20%. T√≠nh ti·ªÅn ph·∫£i tr·∫£?",
            hint: "45.000 √ó 80% = 45.000 √ó 0.8",
            a: ["36000", "36k", "36.000", "36000ƒë"]
        },
        {
            q: "Mua 2 tr√† s·ªØa 35k/ly, 1 b√°nh 25k. T·ªïng bao nhi√™u?",
            hint: "35.000 √ó 2 + 25.000 = ?",
            a: ["95000", "95k", "95.000", "95000ƒë"]
        },
        {
            q: "Date h·∫øt 250k, b·∫°n trai tr·∫£ 60%. B·∫°n g√°i tr·∫£ bao nhi√™u?",
            hint: "B·∫°n g√°i tr·∫£ 40% c·ªßa 250.000",
            a: ["100000", "100k", "100.000", "100000ƒë"]
        },
        {
            q: "V√© xem phim 75k/ng∆∞·ªùi, b·ªèng n∆∞·ªõc 55k.<br>Hai ng∆∞·ªùi h·∫øt bao nhi√™u?",
            hint: "75.000 √ó 2 + 55.000 = ?",
            a: ["205000", "205k", "205.000", "205000ƒë"]
        },
        {
            q: "Mua qu√† sinh nh·∫≠t 320k, ƒë∆∞·ª£c gi·∫£m 15%.<br>Ph·∫£i tr·∫£ bao nhi√™u?",
            hint: "320.000 √ó 85% = 320.000 √ó 0.85",
            a: ["272000", "272k", "272.000", "272000ƒë"]
        },

        // TO√ÅN TH·ªúI GIAN Y√äU NHAU ‚è∞
        {
            q: "Y√™u nhau t·ª´ 14/2, h√¥m nay 14/5.<br>ƒê∆∞·ª£c m·∫•y th√°ng?",
            hint: "ƒê·∫øm: Th√°ng 2 ‚Üí 3 ‚Üí 4 ‚Üí 5",
            a: ["3", "3 th√°ng", "ba"]
        },
        {
            q: "M·ªói tu·∫ßn g·∫∑p nhau 3 l·∫ßn.<br>1 th√°ng (4 tu·∫ßn) g·∫∑p m·∫•y l·∫ßn?",
            hint: "3 √ó 4 = ?",
            a: ["12", "12 l·∫ßn"]
        },
        {
            q: "Chat t·ª´ 8h t·ªëi ƒë·∫øn 11h30 ƒë√™m.<br>Chat ƒë∆∞·ª£c m·∫•y ti·∫øng?",
            hint: "T·ª´ 20:00 ƒë·∫øn 23:30 = ?",
            a: ["3.5", "3,5", "3 ti·∫øng 30", "3 ti·∫øng r∆∞·ª°i"]
        },
        {
            q: "Quen 100 ng√†y, c√£i nhau 5 ng√†y.<br>Vui ƒë∆∞·ª£c bao nhi√™u %?",
            hint: "(100 - 5) √∑ 100 √ó 100%",
            a: ["95", "95%"]
        },
        {
            q: "M·ªói ng√†y nh·∫Øn 50 tin.<br>1 tu·∫ßn nh·∫Øn bao nhi√™u tin?",
            hint: "50 √ó 7 = ?",
            a: ["350", "350 tin"]
        },

        // TO√ÅN KHO·∫¢NG C√ÅCH üö∂
        {
            q: "Nh√† 2 ƒë·ª©a c√°ch nhau 6km.<br>G·∫∑p ·ªü gi·ªØa, m·ªói ng∆∞·ªùi ƒëi m·∫•y km?",
            hint: "6 √∑ 2 = ?",
            a: ["3", "3km", "3 km"]
        },
        {
            q: "ƒêi xe m√°y 30km/h, qu√£ng ƒë∆∞·ªùng 15km.<br>M·∫•t m·∫•y ph√∫t?",
            hint: "15 √∑ 30 = 0.5 gi·ªù = ? ph√∫t",
            a: ["30", "30 ph√∫t", "30p"]
        },
        {
            q: "ƒêi b·ªô 5km/h trong 30 ph√∫t.<br>ƒêi ƒë∆∞·ª£c m·∫•y km?",
            hint: "30 ph√∫t = 0.5 gi·ªù, 5 √ó 0.5 = ?",
            a: ["2.5", "2,5", "2.5km"]
        },
        {
            q: "Nh√† c√°ch tr∆∞·ªùng 3km, ƒëi v·ªÅ 2 l∆∞·ª£t/ng√†y.<br>1 tu·∫ßn ƒëi bao nhi√™u km?",
            hint: "3 √ó 2 √ó 7 = ?",
            a: ["42", "42km", "42 km"]
        },

        // PH∆Ø∆†NG TR√åNH ƒê∆†N GI·∫¢N üìê
        {
            q: "Gi·∫£i ph∆∞∆°ng tr√¨nh: 2x + 5 = 15<br>x = ?",
            hint: "2x = 15 - 5 = 10, x = 10 √∑ 2",
            a: ["5"]
        },
        {
            q: "Gi·∫£i ph∆∞∆°ng tr√¨nh: 3x - 7 = 14<br>x = ?",
            hint: "3x = 14 + 7 = 21, x = 21 √∑ 3",
            a: ["7"]
        },
        {
            q: "Gi·∫£i ph∆∞∆°ng tr√¨nh: 5x + 10 = 35<br>x = ?",
            hint: "5x = 35 - 10 = 25, x = ?",
            a: ["5"]
        },
        {
            q: "Tu·ªïi anh g·∫•p ƒë√¥i tu·ªïi em.<br>T·ªïng 2 tu·ªïi = 36. Tu·ªïi em = ?",
            hint: "Em = x, Anh = 2x, x + 2x = 36",
            a: ["12"]
        },
        {
            q: "x¬≤ = 49. T√¨m x (x > 0)",
            hint: "S·ªë n√†o nh√¢n ch√≠nh n√≥ = 49?",
            a: ["7"]
        },
        {
            q: "‚àö144 = ?",
            hint: "12 √ó 12 = 144",
            a: ["12"]
        },
        {
            q: "‚àö81 + ‚àö16 = ?",
            hint: "9 + 4 = ?",
            a: ["13"]
        },

        // TO√ÅN PH·∫¶N TRƒÇM üìä
        {
            q: "Thi ƒë∆∞·ª£c 8/10 ƒëi·ªÉm. ƒê·∫°t bao nhi√™u %?",
            hint: "8 √∑ 10 √ó 100%",
            a: ["80", "80%"]
        },
        {
            q: "L·ªõp c√≥ 40 ng∆∞·ªùi, 30% l√† nam.<br>C√≥ bao nhi√™u nam?",
            hint: "40 √ó 30% = 40 √ó 0.3",
            a: ["12", "12 ng∆∞·ªùi"]
        },
        {
            q: "Gi√†y 500k gi·∫£m 15%.<br>Gi√° m·ªõi bao nhi√™u?",
            hint: "500.000 √ó 85% = ?",
            a: ["425000", "425k", "425.000"]
        },
        {
            q: "ƒêi·ªÉm thi tƒÉng t·ª´ 6 l√™n 9.<br>TƒÉng bao nhi√™u %?",
            hint: "(9 - 6) √∑ 6 √ó 100%",
            a: ["50", "50%"]
        },

        // TO√ÅN VUI V·ªÄ T√åNH Y√äU üòÇüíï
        {
            q: "1 tin nh·∫Øn = 1 ƒëi·ªÉm y√™u th∆∞∆°ng.<br>G·ª≠i 50 tin/ng√†y √ó 30 ng√†y = ?",
            hint: "50 √ó 30 = ?",
            a: ["1500", "1500 ƒëi·ªÉm"]
        },
        {
            q: "M·ªói l·∫ßn g·∫∑p ƒë∆∞·ª£c +10 ƒëi·ªÉm h·∫°nh ph√∫c.<br>G·∫∑p 12 l·∫ßn/th√°ng, t·ªïng = ?",
            hint: "10 √ó 12 = ?",
            a: ["120", "120 ƒëi·ªÉm"]
        },
        {
            q: "C√£i nhau: -50 ƒëi·ªÉm.<br>L√†m l√†nh: +80 ƒëi·ªÉm.<br>T·ªïng = ?",
            hint: "-50 + 80 = ?",
            a: ["30", "+30", "30 ƒëi·ªÉm"]
        },
        {
            q: "Crush 3 th√°ng + Y√™u 6 th√°ng = ? th√°ng t√¨nh c·∫£m",
            hint: "3 + 6 = ?",
            a: ["9", "9 th√°ng"]
        },
        {
            q: "Ng√†y c√≥ 24h, d√†nh 3h nghƒ© v·ªÅ ny.<br>Chi·∫øm bao nhi√™u %?",
            hint: "3 √∑ 24 √ó 100% = 12.5%",
            a: ["12.5", "12,5", "12.5%"]
        }
    ];
    
    // ==========================================
    // CAPTCHA GENERATOR
    // ==========================================
    function generateCaptcha() {
        var chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
        var captcha = '';
        for (var i = 0; i < 6; i++) {
            captcha += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return captcha;
    }
    
    // ==========================================
    // RANDOM MATH PROBLEM
    // ==========================================
    function getRandomMath() {
        var index = Math.floor(Math.random() * mathProblems.length);
        return mathProblems[index];
    }
    
    // ==========================================
    // UI HELPERS
    // ==========================================
    var stages = [
        { min: 0, max: 10, emoji: 'ü§î', title: 'M·ªõi b·∫Øt ƒë·∫ßu...', msg: 'C√≤n xa l·∫Øm!' },
        { min: 11, max: 25, emoji: 'üòü', title: 'C·ªë g·∫Øng l√™n...', msg: 'M·ªõi c√≥ 1/4 th√¥i!' },
        { min: 26, max: 40, emoji: 'üò¢', title: 'ƒê·ª´ng m√†...', msg: 'K·ª∑ ni·ªám t·ªôi nghi·ªáp!' },
        { min: 41, max: 55, emoji: 'üò≠', title: 'N·ª≠a ƒë∆∞·ªùng r·ªìi!', msg: 'Gi·ªù m·ªõi b·∫Øt ƒë·∫ßu kh√≥!' },
        { min: 56, max: 70, emoji: 'üíî', title: 'Tim ƒëau qu√°...', msg: 'Sao n·ª° l√†m v·∫≠y...' },
        { min: 71, max: 85, emoji: 'üò§', title: 'Quy·∫øt t√¢m gh√™!', msg: 'G·∫ßn xong r·ªìi ƒë√≥!' },
        { min: 86, max: 95, emoji: 'üî•', title: 'S·∫ÆP XONG!', msg: 'C·ªë l√™n n√†o!' },
        { min: 96, max: 99, emoji: 'üíÄ', title: 'C∆† H·ªòI CU·ªêI!', msg: 'Kh√¥ng th·ªÉ quay l·∫°i!' },
        { min: 100, max: 100, emoji: 'üëã', title: 'Vƒ©nh bi·ªát...', msg: 'K·ª∑ ni·ªám ƒë√£ ra ƒëi...' }
    ];
    
    var hints = [
        'N√∫t ƒëang ch·∫°y k√¨a! ƒêu·ªïi theo ƒëi! üèÉ',
        'Ng∆∞·ªùi y√™u bi·∫øt ƒë∆∞·ª£c bu·ªìn l·∫Øm ƒë√≥! üò¢',
        'Nghƒ© l·∫°i ƒëi, k·ª∑ ni·ªám ƒë·∫πp m√†...',
        'Error 404: L√Ω do x√≥a kh√¥ng t√¨m th·∫•y ü§∑',
        'N√∫t "Gi·ªØ l·∫°i" to ƒë·∫πp l·∫Øm! ‚Üê‚Üê‚Üê',
        'T√≠nh to√°n m·ªát ch∆∞a? üìö',
        'G√µ ch·ªØ m·ªèi tay ch∆∞a? ‚å®Ô∏è',
        'N√∫t ch·∫°y nhanh kh√¥ng? üòà',
        'T·ªôi nghi·ªáp ng√≥n tay qu√°... üñ±Ô∏è',
        'Ki√™n nh·∫´n gh√™, nh∆∞ng sai h∆∞·ªõng r·ªìi!',
        'B·∫°n c√≥ th·ªÉ d·ª´ng l·∫°i b·∫•t c·ª© l√∫c n√†o üíï',
        'ƒêi u·ªëng tr√† s·ªØa kh√¥ng? üßã',
        'M·ªói click l√† m·ªôt gi·ªçt n∆∞·ªõc m·∫Øt üò¢',
        'N√∫t: "B·∫Øt ƒë∆∞·ª£c tui th√¨ x√≥a!" üòú',
        'Loading l√Ω do gi·ªØ k·ª∑ ni·ªám... 99%',
        'Hay l√† ƒëi xem phim thay v√¨ x√≥a? üé¨',
        'Chu·ªôt c·ªßa b·∫°n ƒëang kh√≥c ƒë√≥! üñ±Ô∏èüò≠'
    ];
    
    function getStage(count) {
        for (var i = 0; i < stages.length; i++) {
            if (count >= stages[i].min && count <= stages[i].max) return stages[i];
        }
        return stages[0];
    }
    
    function updateMainUI() {
        var stage = getStage(state.clickCount);
        var remaining = CONFIG.CLICKS_REQUIRED - state.clickCount;
        var percent = (state.clickCount / CONFIG.CLICKS_REQUIRED) * 100;
        
        document.getElementById('deleteEmoji').textContent = stage.emoji;
        document.getElementById('deleteTitle').textContent = stage.title;
        document.getElementById('deleteMessage').textContent = stage.msg;
        document.getElementById('deleteProgressBar').style.width = percent + '%';
        document.getElementById('deleteProgressText').textContent = state.clickCount + ' / ' + CONFIG.CLICKS_REQUIRED;
        
        var btnText = remaining > 0 ? 'X√≥a (' + remaining + ')' : 'üéâ XONG!';
        document.getElementById('deleteBtnText').textContent = btnText;
        document.getElementById('flyingBtnText').textContent = btnText;
        
        // Progress bar color
        var bar = document.getElementById('deleteProgressBar');
        if (percent < 30) bar.style.background = 'linear-gradient(90deg, #a855f7, #ec4899)';
        else if (percent < 60) bar.style.background = 'linear-gradient(90deg, #f59e0b, #ef4444)';
        else if (percent < 90) bar.style.background = 'linear-gradient(90deg, #ef4444, #dc2626)';
        else bar.style.background = 'linear-gradient(90deg, #dc2626, #7f1d1d)';
        
        // Random hint
        if (state.clickCount > 0 && state.clickCount % 5 === 0) {
            document.getElementById('deleteHint').textContent = hints[Math.floor(Math.random() * hints.length)];
        }
        
        updateChallengeQueue();
    }
    
    function updateChallengeQueue() {
        var queue = document.getElementById('queueItems');
        var items = [];
        
        var nextCaptcha = Math.ceil((state.clickCount + 1) / CONFIG.CAPTCHA_INTERVAL) * CONFIG.CAPTCHA_INTERVAL;
        if (nextCaptcha <= CONFIG.CLICKS_REQUIRED) {
            items.push('<span class="queue-item captcha">üîê CAPTCHA t·∫°i click ' + nextCaptcha + '</span>');
        }
        
        if (state.clickCount < CONFIG.MATH_START_AT) {
            items.push('<span class="queue-item math">üìê TO√ÅN t·ª´ click ' + CONFIG.MATH_START_AT + '</span>');
        } else {
            items.push('<span class="queue-item math active">üìê TO√ÅN ƒëang ho·∫°t ƒë·ªông!</span>');
        }
        
        if (!state.typeDone) {
            if (state.clickCount < CONFIG.TYPE_TRIGGER) {
                items.push('<span class="queue-item type">‚å®Ô∏è G√ï CH·ªÆ t·∫°i click ' + CONFIG.TYPE_TRIGGER + '</span>');
            }
        } else {
            items.push('<span class="queue-item type done">‚å®Ô∏è G√ï CH·ªÆ ‚úì Ho√†n th√†nh</span>');
        }
        
        items.push('<span class="queue-item flying">üéØ N√öT BAY m·ªói click!</span>');
        
        queue.innerHTML = items.join('');
    }
    
    // ==========================================
    // N√öT BAY KH·∫ÆP M√ÄN H√åNH üöÄ
    // ==========================================
    function moveButtonToRandom() {
        var btn = document.getElementById('flyingDeleteBtn');
        var modalBtn = document.getElementById('confirmDeleteBtn');
        
        // ·∫®n n√∫t trong modal, hi·ªán n√∫t bay
        modalBtn.style.visibility = 'hidden';
        btn.style.display = 'flex';
        state.buttonIsFlying = true;
        
        // Random position tr√™n m√†n h√¨nh
        var padding = 80;
        var btnWidth = 150;
        var btnHeight = 50;
        var maxX = window.innerWidth - btnWidth - padding;
        var maxY = window.innerHeight - btnHeight - padding;
        
        var randomX = padding + Math.random() * maxX;
        var randomY = padding + Math.random() * maxY;
        
        btn.style.left = randomX + 'px';
        btn.style.top = randomY + 'px';
        
        // Hi·ªÉn th·ªã countdown quay l·∫°i
        document.getElementById('returnCountdown').style.display = 'block';
        startReturnCountdown();
    }
    
    function returnButtonToModal() {
        var btn = document.getElementById('flyingDeleteBtn');
        var modalBtn = document.getElementById('confirmDeleteBtn');
        
        btn.style.display = 'none';
        modalBtn.style.visibility = 'visible';
        state.buttonIsFlying = false;
        
        document.getElementById('returnCountdown').style.display = 'none';
        clearInterval(state.returnCountdown);
        clearTimeout(state.returnTimer);
    }
    
    function startReturnCountdown() {
        clearInterval(state.returnCountdown);
        clearTimeout(state.returnTimer);
        
        var timeLeft = CONFIG.BUTTON_RETURN_SECONDS;
        document.getElementById('returnTime').textContent = timeLeft;
        
        state.returnCountdown = setInterval(function() {
            timeLeft--;
            document.getElementById('returnTime').textContent = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(state.returnCountdown);
            }
        }, 1000);
        
        state.returnTimer = setTimeout(function() {
            returnButtonToModal();
        }, CONFIG.BUTTON_RETURN_SECONDS * 1000);
    }
    
    // ==========================================
    // CHALLENGE SYSTEM
    // ==========================================
    function addChallenge(type) {
        if (state.pendingChallenges.indexOf(type) === -1) {
            state.pendingChallenges.push(type);
        }
    }
    
    function processNextChallenge() {
        if (state.pendingChallenges.length === 0) {
            enableDeleteButton();
            return;
        }
        
        var challenge = state.pendingChallenges.shift();
        
        switch(challenge) {
            case 'captcha':
                showCaptcha();
                break;
            case 'math':
                showMath();
                break;
            case 'type':
                showType();
                break;
            case 'cooldown':
                startCooldown();
                break;
        }
    }
    
    function disableDeleteButton() {
        document.getElementById('confirmDeleteBtn').disabled = true;
        document.getElementById('flyingDeleteBtn').disabled = true;
    }
    
    function enableDeleteButton() {
        document.getElementById('confirmDeleteBtn').disabled = false;
        document.getElementById('flyingDeleteBtn').disabled = false;
    }
    
    // ==========================================
    // CAPTCHA üîê
    // ==========================================
    function showCaptcha() {
        state.currentCaptcha = generateCaptcha();
        document.getElementById('captchaDisplay').textContent = state.currentCaptcha;
        document.getElementById('captchaInput').value = '';
        document.getElementById('captchaError').style.display = 'none';
        document.getElementById('captchaChallenge').style.display = 'block';
        disableDeleteButton();
        document.getElementById('deleteHint').textContent = 'üîê Nh·∫≠p CAPTCHA ƒë·ªÉ ti·∫øp t·ª•c!';
        
        // Focus v√†o input
        setTimeout(function() {
            document.getElementById('captchaInput').focus();
        }, 100);
    }
    
    function hideCaptcha() {
        document.getElementById('captchaChallenge').style.display = 'none';
    }
    
    document.getElementById('captchaSubmit').addEventListener('click', function() {
        var input = document.getElementById('captchaInput').value.toUpperCase().trim();
        if (input === state.currentCaptcha) {
            hideCaptcha();
            document.getElementById('deleteHint').textContent = '‚úÖ CAPTCHA ƒë√∫ng!';
            processNextChallenge();
        } else {
            document.getElementById('captchaError').style.display = 'block';
            state.currentCaptcha = generateCaptcha();
            document.getElementById('captchaDisplay').textContent = state.currentCaptcha;
            document.getElementById('captchaInput').value = '';
            document.getElementById('captchaInput').focus();
        }
    });
    
    // ==========================================
    // TO√ÅN T√åNH Y√äU üìêüíï
    // ==========================================
    function showMath() {
        state.currentMath = getRandomMath();
        document.getElementById('mathProblem').innerHTML = state.currentMath.q;
        document.getElementById('mathHint').textContent = 'üí° ' + state.currentMath.hint;
        document.getElementById('mathHint').style.display = 'none';
        document.getElementById('mathInput').value = '';
        document.getElementById('mathError').style.display = 'none';
        document.getElementById('mathChallenge').style.display = 'block';
        disableDeleteButton();
        document.getElementById('deleteHint').textContent = 'üìê Gi·∫£i to√°n t√¨nh y√™u ƒë·ªÉ ti·∫øp t·ª•c!';
        
        setTimeout(function() {
            document.getElementById('mathInput').focus();
        }, 100);
    }
    
    function hideMath() {
        document.getElementById('mathChallenge').style.display = 'none';
    }
    
    document.getElementById('mathHintBtn').addEventListener('click', function() {
        document.getElementById('mathHint').style.display = 'block';
    });
    
    document.getElementById('mathSubmit').addEventListener('click', function() {
        var input = document.getElementById('mathInput').value.toLowerCase().replace(/\s/g, '').replace(/,/g, '.');
        var correct = false;
        
        for (var i = 0; i < state.currentMath.a.length; i++) {
            var answer = state.currentMath.a[i].toLowerCase().replace(/\s/g, '').replace(/,/g, '.');
            if (input === answer) {
                correct = true;
                break;
            }
        }
        
        if (correct) {
            hideMath();
            document.getElementById('deleteHint').textContent = 'üéâ ƒê√∫ng r·ªìi! T√≠nh to√°n gi·ªèi gh√™!';
            processNextChallenge();
        } else {
            document.getElementById('mathError').style.display = 'block';
            document.getElementById('mathHint').style.display = 'block';
            document.getElementById('mathInput').focus();
        }
    });
    
    // ==========================================
    // G√ï CH·ªÆ ‚å®Ô∏è
    // ==========================================
    var REQUIRED_SENTENCE = "T√¥i kh√¥ng mu·ªën x√≥a k·ª∑ ni·ªám ƒë·∫πp n√†y";
    
    function showType() {
        state.typeCount = 0;
        document.getElementById('typeInput').value = '';
        document.getElementById('typeProgress').textContent = '‚úÖ 0 / ' + CONFIG.TYPE_REQUIRED + ' l·∫ßn';
        document.getElementById('typeError').style.display = 'none';
        document.getElementById('typeChallenge').style.display = 'block';
        disableDeleteButton();
        document.getElementById('deleteHint').textContent = '‚å®Ô∏è G√µ c√¢u ' + CONFIG.TYPE_REQUIRED + ' l·∫ßn!';
        
        setTimeout(function() {
            document.getElementById('typeInput').focus();
        }, 100);
    }
    
    function hideType() {
        document.getElementById('typeChallenge').style.display = 'none';
    }
    
    document.getElementById('typeSubmit').addEventListener('click', function() {
        var input = document.getElementById('typeInput').value.trim();
        
        if (input === REQUIRED_SENTENCE) {
            state.typeCount++;
            document.getElementById('typeProgress').textContent = '‚úÖ ' + state.typeCount + ' / ' + CONFIG.TYPE_REQUIRED + ' l·∫ßn';
            document.getElementById('typeInput').value = '';
            document.getElementById('typeError').style.display = 'none';
            
            if (state.typeCount >= CONFIG.TYPE_REQUIRED) {
                state.typeDone = true;
                hideType();
                document.getElementById('deleteHint').textContent = 'üò§ G√µ xong! Quy·∫øt t√¢m gh√™...';
                processNextChallenge();
            } else {
                document.getElementById('typeInput').focus();
            }
        } else {
            document.getElementById('typeError').style.display = 'block';
            document.getElementById('typeInput').focus();
        }
    });
    
    // ==========================================
    // COOLDOWN ‚è±Ô∏è
    // ==========================================
    function startCooldown() {
        state.isOnCooldown = true;
        disableDeleteButton();
        
        var timeLeft = CONFIG.COOLDOWN_SECONDS;
        document.getElementById('cooldownDisplay').style.display = 'block';
        document.getElementById('cooldownTime').textContent = timeLeft;
        document.getElementById('cooldownProgress').style.width = '100%';
        
        state.cooldownTimer = setInterval(function() {
            timeLeft--;
            document.getElementById('cooldownTime').textContent = timeLeft;
            document.getElementById('cooldownProgress').style.width = ((timeLeft / CONFIG.COOLDOWN_SECONDS) * 100) + '%';
            
            if (timeLeft <= 0) {
                clearInterval(state.cooldownTimer);
                state.isOnCooldown = false;
                document.getElementById('cooldownDisplay').style.display = 'none';
                processNextChallenge();
            }
        }, 1000);
    }
    
    // ==========================================
    // MAIN CLICK HANDLER üñ±Ô∏è
    // ==========================================
    function handleDeleteClick() {
        if (state.isOnCooldown || state.pendingChallenges.length > 0) return;
        
        state.clickCount++;
        updateMainUI();
        
        // Reset return timer n·∫øu ƒëang bay
        if (state.buttonIsFlying) {
            clearInterval(state.returnCountdown);
            clearTimeout(state.returnTimer);
        }
        
        // Check ho√†n th√†nh
        if (state.clickCount >= CONFIG.CLICKS_REQUIRED) {
            document.getElementById('deleteHint').textContent = 'üéâ HO√ÄN TH√ÄNH! ƒêang x√≥a k·ª∑ ni·ªám...';
            document.getElementById('returnCountdown').style.display = 'none';
            disableDeleteButton();
            
            var flyBtn = document.getElementById('flyingDeleteBtn');
            flyBtn.innerHTML = 'üéâ XONG!';
            flyBtn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
            
            setTimeout(function() {
                window.location.href = state.deleteUrl;
            }, 2000);
            return;
        }
        
        // Th√™m challenges v√†o queue
        state.pendingChallenges = [];
        
        // CAPTCHA m·ªói 10 click
        if (state.clickCount % CONFIG.CAPTCHA_INTERVAL === 0) {
            addChallenge('captcha');
        }
        
        // TO√ÅN t·ª´ click 50 tr·ªü ƒëi, m·ªói 10 click
        if (state.clickCount >= CONFIG.MATH_START_AT && state.clickCount % CONFIG.CAPTCHA_INTERVAL === 0) {
            addChallenge('math');
        }
        
        // G√ï CH·ªÆ t·∫°i click 50
        if (state.clickCount === CONFIG.TYPE_TRIGGER && !state.typeDone) {
            addChallenge('type');
        }
        
        // Cooldown sau m·ªói challenge batch
        if (state.pendingChallenges.length > 0) {
            addChallenge('cooldown');
        }
        
        // Di chuy·ªÉn n√∫t bay kh·∫Øp m√†n h√¨nh
        moveButtonToRandom();
        
        // Process challenges
        if (state.pendingChallenges.length > 0) {
            processNextChallenge();
        }
    }
    
    // ==========================================
    // EVENT LISTENERS
    // ==========================================
    
    // M·ªü modal
    document.querySelectorAll('.btn-delete-trigger').forEach(function(btn) {
        btn.addEventListener('click', function() {
            state.deleteUrl = this.getAttribute('data-delete-url');
            state.clickCount = 0;
            state.typeCount = 0;
            state.typeDone = false;
            state.pendingChallenges = [];
            state.isOnCooldown = false;
            
            // Reset UI
            hideCaptcha();
            hideMath();
            hideType();
            returnButtonToModal();
            document.getElementById('cooldownDisplay').style.display = 'none';
            document.getElementById('returnCountdown').style.display = 'none';
            document.getElementById('deleteHint').textContent = 'B·∫•m n√∫t ƒë·ªÉ b·∫Øt ƒë·∫ßu h√†nh tr√¨nh ƒë·ªãa ng·ª•c üíÄ';
            enableDeleteButton();
            
            // Reset flying button style
            var flyBtn = document.getElementById('flyingDeleteBtn');
            flyBtn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
            
            updateMainUI();
            document.getElementById('deleteModal').classList.add('active');
        });
    });
    
    // Click n√∫t x√≥a (trong modal)
    document.getElementById('confirmDeleteBtn').addEventListener('click', handleDeleteClick);
    
    // Click n√∫t bay
    document.getElementById('flyingDeleteBtn').addEventListener('click', handleDeleteClick);
    
    // Cancel
    document.getElementById('cancelDeleteBtn').addEventListener('click', function() {
        document.getElementById('deleteModal').classList.remove('active');
        returnButtonToModal();
        clearInterval(state.cooldownTimer);
        clearInterval(state.returnCountdown);
        clearTimeout(state.returnTimer);
    });
    
    // Click outside modal - KH√îNG ƒë√≥ng modal n·ªØa (√°c h∆°n üòà)
    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) {
            // Kh√¥ng l√†m g√¨ c·∫£ - kh√¥ng cho ƒë√≥ng b·∫±ng click outside
            document.getElementById('deleteHint').textContent = 'üòà Click ra ngo√†i kh√¥ng tho√°t ƒë∆∞·ª£c ƒë√¢u!';
        }
    });
    
    // Enter keys
    document.getElementById('captchaInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') document.getElementById('captchaSubmit').click();
    });
    document.getElementById('mathInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') document.getElementById('mathSubmit').click();
    });
    document.getElementById('typeInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') document.getElementById('typeSubmit').click();
    });
    
    // ESC key - c≈©ng kh√¥ng cho tho√°t üòà
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && document.getElementById('deleteModal').classList.contains('active')) {
            e.preventDefault();
            document.getElementById('deleteHint').textContent = 'üòà ESC c≈©ng kh√¥ng tho√°t ƒë∆∞·ª£c ƒë√¢u!';
        }
    });
</script>

<style>
    /* ==========================================
       FLYING BUTTON - N√öT BAY KH·∫ÆP M√ÄN H√åNH üöÄ
       ========================================== */
    .flying-delete-btn {
        position: fixed;
        z-index: 10001;
        padding: 15px 30px;
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 10px 40px rgba(239, 68, 68, 0.5);
        transition: left 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55), 
                    top 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55),
                    transform 0.2s ease,
                    box-shadow 0.2s ease;
        display: none;
        align-items: center;
        justify-content: center;
        font-family: 'Quicksand', sans-serif;
        animation: pulse 1s infinite;
        min-width: 140px;
    }
    
    .flying-delete-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 15px 50px rgba(239, 68, 68, 0.7);
    }
    
    .flying-delete-btn:active {
        transform: scale(0.95);
    }
    
    .flying-delete-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        animation: none;
    }
    
    @keyframes pulse {
        0%, 100% { box-shadow: 0 10px 40px rgba(239, 68, 68, 0.5); }
        50% { box-shadow: 0 10px 60px rgba(239, 68, 68, 0.8); }
    }
    
    /* ==========================================
       DELETE MODAL STYLES
       ========================================== */
    .delete-modal-content {
        max-width: 520px;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .delete-header {
        text-align: center;
        margin-bottom: 15px;
    }
    
    .delete-emoji {
        font-size: 60px;
        display: block;
        margin-bottom: 10px;
    }
    
    .delete-header h3 {
        color: var(--primary-dark);
        margin: 0 0 5px 0;
    }
    
    .delete-tagline {
        font-size: 14px;
        color: #888;
        font-style: italic;
        margin: 0;
    }
    
    #deleteMessage {
        text-align: center;
        color: var(--text-light);
        margin-bottom: 15px;
    }
    
    /* Progress bar */
    .delete-progress-container {
        background: #f0f0f0;
        border-radius: 20px;
        height: 30px;
        position: relative;
        overflow: hidden;
        margin-bottom: 15px;
    }
    
    .delete-progress-bar {
        height: 100%;
        width: 0%;
        border-radius: 20px;
        transition: all 0.3s ease;
    }
    
    .delete-progress-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-weight: 700;
        font-size: 14px;
        color: #333;
        text-shadow: 0 0 10px white;
    }
    
    /* Challenge queue */
    .challenge-queue {
        background: #fefce8;
        border: 2px solid #fde047;
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 15px;
    }
    
    .queue-title {
        font-weight: 700;
        color: #854d0e;
        margin-bottom: 8px;
        font-size: 13px;
    }
    
    .queue-items {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }
    
    .queue-item {
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
    }
    
    .queue-item.captcha { background: #dbeafe; color: #1e40af; }
    .queue-item.math { background: #f3e8ff; color: #7c3aed; }
    .queue-item.math.active { background: #7c3aed; color: white; }
    .queue-item.type { background: #dcfce7; color: #166534; }
    .queue-item.type.done { background: #166534; color: white; }
    .queue-item.flying { background: #fee2e2; color: #dc2626; }
    
    /* Challenge boxes */
    .challenge-box {
        background: #f8fafc;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        text-align: center;
    }
    
    .challenge-header {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
        margin-bottom: 12px;
    }
    
    .captcha-header { background: #dbeafe; color: #1e40af; }
    .math-header { background: #f3e8ff; color: #7c3aed; }
    .type-header { background: #dcfce7; color: #166534; }
    
    .captcha-display {
        font-family: 'Courier New', monospace;
        font-size: 32px;
        font-weight: bold;
        letter-spacing: 8px;
        background: linear-gradient(135deg, #1e293b, #334155);
        color: #22d3ee;
        padding: 15px 25px;
        border-radius: 8px;
        margin: 15px 0;
        text-align: center;
        user-select: none;
        text-shadow: 0 0 10px #22d3ee;
    }
    
    .math-problem {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-dark);
        padding: 15px;
        background: white;
        border-radius: 8px;
        border-left: 4px solid #7c3aed;
        margin-bottom: 15px;
        text-align: center;
        line-height: 1.6;
    }
    
    .type-sentence {
        font-size: 15px;
        font-weight: 600;
        color: var(--primary-dark);
        background: white;
        padding: 12px;
        border-radius: 8px;
        margin: 10px 0;
        border: 2px dashed var(--primary-light);
        text-align: center;
    }
    
    .challenge-box input,
    .challenge-box textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 16px;
        margin-bottom: 10px;
        font-family: 'Quicksand', sans-serif;
        box-sizing: border-box;
    }
    
    .challenge-box input:focus,
    .challenge-box textarea:focus {
        outline: none;
        border-color: var(--primary);
    }
    
    .btn-challenge {
        width: 100%;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border: none;
        padding: 12px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Quicksand', sans-serif;
    }
    
    .btn-challenge:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 107, 157, 0.4);
    }
    
    .btn-hint {
        margin-top: 10px;
        background: none;
        border: 1px dashed #ccc;
        padding: 8px 15px;
        border-radius: 8px;
        color: #888;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.3s ease;
    }
    
    .btn-hint:hover {
        background: #f5f5f5;
        color: #666;
    }
    
    .challenge-error {
        color: #ef4444;
        font-size: 14px;
        margin-top: 10px;
    }
    
    .math-hint {
        color: #059669;
        font-size: 13px;
        font-style: italic;
        margin-top: 10px;
        padding: 10px;
        background: #ecfdf5;
        border-radius: 8px;
    }
    
    .type-progress {
        font-size: 14px;
        color: #059669;
        font-weight: 600;
        margin-top: 10px;
    }
    
    /* Cooldown */
    .cooldown-display {
        text-align: center;
        margin-bottom: 15px;
        padding: 15px;
        background: #fef3c7;
        border-radius: 12px;
    }
    
    .cooldown-display p {
        color: #b45309;
        font-weight: 600;
        margin: 0 0 10px 0;
    }
    
    .cooldown-bar {
        background: #fde68a;
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
    }
    
    .cooldown-progress {
        height: 100%;
        background: linear-gradient(90deg, #f59e0b, #d97706);
        transition: width 1s linear;
    }
    
    /* Return countdown */
    .return-countdown {
        text-align: center;
        padding: 12px;
        background: #fee2e2;
        border-radius: 12px;
        margin-bottom: 15px;
    }
    
    .return-countdown p {
        margin: 0;
        color: #dc2626;
        font-weight: 600;
    }
    
    .return-hint {
        font-size: 12px !important;
        color: #ef4444 !important;
        margin-top: 5px !important;
        font-style: italic;
    }
    
    /* Hint */
    .delete-hint {
        text-align: center;
        font-size: 13px;
        color: var(--text-light);
        margin-bottom: 20px;
        font-style: italic;
        min-height: 20px;
    }
    
    /* Modal actions */
    .modal-actions {
        display: flex;
        gap: 15px;
        align-items: center;
    }
    
    .btn-keep {
        flex: 2;
        padding: 15px 25px;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border: none;
        border-radius: var(--radius-sm);
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Quicksand', sans-serif;
    }
    
    .btn-keep:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 20px rgba(255, 107, 157, 0.4);
    }
    
    .delete-btn-container {
        flex: 1;
    }
    
    .btn-delete-confirm {
        width: 100%;
        padding: 15px 20px;
        background: #f5f5f5;
        color: #999;
        border: 2px dashed #ddd;
        border-radius: var(--radius-sm);
        font-size: 12px;
        cursor: pointer;
        transition: all 0.15s ease;
        font-family: 'Quicksand', sans-serif;
    }
    
    .btn-delete-confirm:hover:not(:disabled) {
        background: #fee2e2;
        border-color: #fca5a5;
        color: #ef4444;
    }
    
    .btn-delete-confirm:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    /* Entry actions */
    .entry-actions {
        display: flex;
        gap: 8px;
    }
    
    .btn-edit {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border: none;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
    }
    
    .btn-edit:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
    }
    
    .btn-delete-trigger {
        background: none;
        border: none;
        color: #ddd;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        opacity: 0;
    }
    
    .diary-entry:hover .btn-delete-trigger {
        opacity: 1;
    }
    
    .btn-delete-trigger:hover {
        background: #fee2e2;
        color: #ef4444;
    }
    
    /* Responsive */
    @media (max-width: 480px) {
        .flying-delete-btn {
            padding: 12px 20px;
            font-size: 14px;
            min-width: 120px;
        }
        
        .modal-actions {
            flex-direction: column;
        }
        
        .btn-keep, .delete-btn-container {
            width: 100%;
            flex: none;
        }
    }
</style>
{% endblock %}